# -*-shell-script-*-

. "$genapp_functions/core"

#config_symfony()
#{
#    echo "Configuring Symfony"
#    mkdir -m 700 "$app_dir/.drushini"
#    install -m 600 "$plugin_dir/conf/drush.ini" "$app_dir/.drushini/php.ini"
#    sed -i "2iapp_dir = $app_dir" "$app_dir/.drushini/php.ini"
#}

install_symfony()
{
    if [ -e "$app_dir/plugins/newrelic" ]; then
        echo "Writing framework to NewRelic configuration"
        echo "newrelic.framework = symfony" >> "$app_dir/conf/php.ini"
    fi

    echo "Writing httpd config"
    paste "$plugin_dir/conf/drupal.head.conf" "$app_dir/conf/httpd.head.conf" \
    > "$app_dir/conf/httpd.head.conf"
    paste "$plugin_dir/conf/drupal.site.conf" "$app_dir/conf/httpd.site.conf" \
    > "$app_dir/conf/httpd.site.conf"
    paste "$plugin_dir/conf/symfony-php.ini" "$app_dir/conf/php.ini" \
    > "$app_dir/conf/php.ini"

    echo "Setting up symfony"

    cd "$app_dir"

    echo "Rewriting permissions post-install"
    chmod -R g-w,o-rwx "$app_dir/app"

    #TODO: verify the loop will change the necessary perms.

    #for _dir in \
    #Symfony Symfony/app Symfony/app/cache Symfony/app/cache/prod Symfony/app/cache/dev Symfony/app/logs Symfony/src/* Symfony/web/*
    #do
    #  if [ -e "$_dir" ]; then
    #      chmod -R g+w "$_dir"
    #  fi
    #done
		
	  chmod g+w `find . -type d`
		
    cd "$_curdir"
}